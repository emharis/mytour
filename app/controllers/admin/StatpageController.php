<?php
 namespace App\Controllers\Admin;class StatpageController extends\BaseController{public function getIndex(){return\View::make('admin.statpage.index',array('statpages'=>\App\Models\Statpage::all()));}public function getNew(){$a=\App\Models\Menu::where('type',2)->where('publish','Y')->whereNull('statpage_id')->get();$b=array();$b[0]='---No Menu---';foreach($a as $c){$b[$c->id]=$c->nama;}return\View::make('admin.statpage.new',array('selectMenu'=>$b));}public function postNew(){\DB::transaction(function(){$d=new\App\Models\Statpage();$d->nama=\Input::get('nama');$d->konten=\Input::get('konten');$d->default_konten=\Input::get('konten');$d->save();if(\Input::get('menu')>0){$d->menu_id=\Input::get('menu');$e=\App\Models\Menu::find(\Input::get('menu'));$e->statpage_id=$d->id;$e->save();}});return\Redirect::to('admin/statpage');}public function getEdit($f){$a=\App\Models\Menu::where('type',2)->where('publish','Y')->whereNull('statpage_id')->get();$b=array();$b[0]='---No Menu---';foreach($a as $c){$b[$c->id]=$c->nama;}$d=\App\Models\Statpage::find($f);return\View::make('admin.statpage.edit',array('selectMenu'=>$b,'statpage'=>$d));}public function postEdit(){\DB::transaction(function(){$d=\App\Models\Statpage::find(\Input::get('statpageId'));$d->nama=\Input::get('nama');$d->konten=\Input::get('konten');$d->save();if(\Input::get('menu')){if(\Input::get('menu')>0){$d->menu_id=\Input::get('menu');$e=\App\Models\Menu::find(\Input::get('menu'));$e->statpage_id=$d->id;$e->save();}}});return\Redirect::back();}public function getDelmenu($f){$g=\App\Models\Statpage::find($f);$e=$g->menu;$e->statpage_id=null;$e->save();return\Redirect::back();}public function getDelete($f){\DB::transaction(function()use($f){$g=\App\Models\Statpage::find($f);if($g->menu!=null){$e=$g->menu;$e->statpage_id=null;$e->save();}$g->delete();});return\Redirect::to('admin/statpage');}}